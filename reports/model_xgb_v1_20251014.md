# XGBoost v1 - Model Report

**Date**: 2025-10-14
**Timestamp**: 20251014_000127
**Seed**: 20251013

---

## Executive Summary

First XGBoost baseline model trained on 1,942 completed NFL games (2018-2024) using rolling weekly cross-validation. Model achieves **test log loss of 0.6276** and **Brier score of 0.2190**. Spread is the dominant feature (68% importance), with Elo difference second (14%).

**‚ö†Ô∏è Calibration Issue**: Model is overconfident with calibration slope of 4.94 (ideal=1.0), indicating predictions require recalibration before use.

---

## Dataset

- **Total games**: 1,942 (2018-2024 seasons)
- **Train games**: 1,369 (weeks 2018_01 to 2022_20)
- **Test games**: 573 (weeks 2022_21 to 2024_22)
- **Train/test split**: 70/30 by weeks (temporal split)
- **Target balance**: 54.3% home wins

---

## Features (v1.1)

11 features used:

1. **home** - Home indicator (always 1)
2. **spread_close** - Closing spread (home perspective)
3. **total_close** - Closing over/under
4. **week** - Week number (1-22)
5. **rest_home_capped** - Home rest days (capped at 14)
6. **rest_away_capped** - Away rest days (capped at 14)
7. **first_game_home** - Home team season opener flag
8. **first_game_away** - Away team season opener flag
9. **prev_margin_home** - Home team's previous margin
10. **prev_margin_away** - Away team's previous margin
11. **elo_diff** - Elo difference (home - away + HFA)

**Note**: Weather features excluded (pending Meteostat integration).

---

## Cross-Validation

- **Method**: Rolling weekly (temporal split)
- **Hyperparameter search**: 20 random trials
- **CV folds**: 5-fold within training data
- **Early stopping**: 20 rounds

### Best Parameters

- max_depth: 3
- eta: 0.1
- min_child_weight: 3
- subsample: 0.9
- colsample_bytree: 0.9
- lambda: 1
- nrounds: 200 (early stopped varies by trial)

---

## Performance Metrics

| Split | Log Loss | Brier Score |
|-------|----------|-------------|
| Train | 0.5765   | 0.1963      |
| Test  | 0.6276   | 0.2190      |

**Interpretation**:
- Moderate overfit (train vs test gap ~0.05 log loss)
- Test log loss of 0.6276 is reasonable for NFL prediction
- Brier score of 0.2190 indicates avg squared error of ~22%

---

## Feature Importance (Gain)

| Rank | Feature           | Gain   | Interpretation |
|------|-------------------|--------|----------------|
| 1    | spread_close      | 68.0%  | Market odds dominate |
| 2    | elo_diff          | 14.3%  | Power ratings matter |
| 3    | prev_margin_away  | 5.4%   | Recent form (away) |
| 4    | total_close       | 4.2%   | Game script context |
| 5    | prev_margin_home  | 4.1%   | Recent form (home) |
| 6    | week              | 2.7%   | Seasonal patterns |
| 7    | rest_away_capped  | 1.2%   | Rest advantage (away) |
| 8    | rest_home_capped  | 0.2%   | Rest advantage (home) minimal |

**Key Finding**: Spread accounts for 68% of predictive power, suggesting market is highly efficient. Elo and recent form provide incremental value.

---

## Calibration Analysis

### Calibration Metrics

- **Slope**: 4.94 (ideal=1.0) ‚ö†Ô∏è  **OUT OF RANGE**
- **Intercept**: -2.35 (ideal=0.0)
- **Status**: FAIL (slope not in [0.8, 1.2])

### Interpretation

**Problem**: Model is significantly **overconfident**. A slope of 4.94 means:
- Predicted probabilities are too extreme
- Model underestimates uncertainty
- Predictions require post-hoc calibration (e.g., Platt scaling, isotonic regression)

**Example**: If model predicts 60% win probability, true frequency might be closer to 55%.

### Reliability Table (10 bins)

Calibration plot saved to: `artifacts/20251014_000127/xgb/calibration.png`

---

## Known Caveats

1. **Overconfidence**: Calibration slope 4.94 >> 1.0
   - **Mitigation**: Apply post-hoc calibration before deployment

2. **Market efficiency**: Spread dominates (68% importance)
   - **Implication**: Hard to beat market without additional edge
   - **Next step**: Integrate multiple sportsbook odds for meta-model

3. **Weather missing**: Wind/temp/precip all NA
   - **Impact**: Unknown, but weather affects outdoor games
   - **Next step**: Meteostat integration (v1.5)

4. **Temporal leakage check**: ‚úÖ PASS
   - All features computed from pre-game data only
   - No post-game info in training features

---

## Next Steps

### Immediate (v1.2)
1. **Fix calibration**: Apply Platt scaling or isotonic regression
2. **Validate calibration**: Re-test on held-out data
3. **Baseline comparison**: Compare to naive (always predict spread)

### Short-term (v1.5)
4. **Add weather**: Integrate Meteostat (wind, temp, precip)
5. **Travel distance**: Add miles traveled for away team
6. **Division games**: Flag intra-division matchups

### Medium-term (v2)
7. **Multi-source odds**: Ingest from multiple sportsbooks
8. **Meta-model**: Learn source-specific calibration
9. **De-vig methods**: Compare multiplicative/additive/Shin

### Long-term (v3)
10. **BART**: Add Bayesian trees for uncertainty quantification
11. **Conformal prediction**: Generate prediction intervals
12. **Ensemble**: Combine XGBoost + BART

---

## Artifacts

All artifacts saved to: `artifacts/20251014_000127/xgb/`

| File | Description |
|------|-------------|
| model.xgb | Trained XGBoost model (binary) |
| results.json | Hyperparameters and metrics |
| cv_results.csv | All 20 CV trial results |
| feature_importance.csv | Feature importance scores |
| feature_importance.png | Top 10 features plot |
| calibration.png | Calibration curve (predicted vs observed) |
| calibration_summary.csv | Slope/intercept/status |
| reliability.csv | 10-bin reliability table |

---

## Reproducibility

```bash
# Re-run model training
Rscript R/04_xgb_fit.R --in data/processed --cv weekly --seed 20251013
```

**Random seed**: 20251013 (fixed for reproducibility)

---

## Conclusion

XGBoost v1 provides a reasonable baseline (test log loss 0.6276) but requires calibration before deployment due to significant overconfidence (slope=4.94). Spread dominates feature importance (68%), confirming market efficiency. Next priorities: fix calibration, add weather data, and progress toward multi-source meta-model.

**Status**: ‚úÖ Baseline established | ‚ö†Ô∏è Calibration needed | üöß Not production-ready
